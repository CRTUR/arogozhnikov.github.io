---
layout: post
title: Machine learning in COMET experiment (part II)
date: '2015-07-04T16:21:00.001-07:00'
author: Alex
tags:
- Machine Learning
- High Energy Physics
- Gradient Boosting
- tracking
- COMET
modified_time: '2015-07-04T17:00:15.185-07:00'
thumbnail: http://2.bp.blogspot.com/-eYLtvVRWdGU/VYfdHNzhhJI/AAAAAAAAAEY/GN0Zl_lrRV8/s72-c/COMETdepositions.png
blogger_id: tag:blogger.com,1999:blog-307916792578626510.post-5396254184769962082
blogger_orig_url: http://brilliantlywrong.blogspot.com/2015/07/machine-learning-in-comet-experiment.html
---

In <a href="http://brilliantlywrong.blogspot.com/2015/06/machine-learning-used-in-tracking-of.html">previous post</a> I've written a short explanation of COMET - Japanese experiment in particle physics. This second post will be devoted to machine learning approach we developed for <i>tracking</i> (currently this is uses the information which is probably unavailable in online, but I still hope we will be able to get some online information and thus apply part of the approach as high-level trigger).<br /><br /><h3>Local wire features</h3>Anyway, the data we are going to use in classification is:<br /><ul><li>energy deposit for each wire</li><li>time of deposit for each wire</li></ul><br />Let's look at their distributions:<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-eYLtvVRWdGU/VYfdHNzhhJI/AAAAAAAAAEY/GN0Zl_lrRV8/s1600/COMETdepositions.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="269" src="http://2.bp.blogspot.com/-eYLtvVRWdGU/VYfdHNzhhJI/AAAAAAAAAEY/GN0Zl_lrRV8/s320/COMETdepositions.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Energy deposited on each 'wire' by signal and background tracks</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><img border="0" height="248" src="http://4.bp.blogspot.com/-aDIn8YqBvJY/VZXfcC4EwSI/AAAAAAAAAGk/7cSgKa80KkA/s320/COMETtiming.png" style="margin-left: auto; margin-right: auto;" width="320" /></td></tr><tr><td class="tr-caption" style="text-align: center;">Time elapsed starting from the moment of triggering till the time when particles are detected.</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"><br /></div><br />How do we obtain these values?<br />COMET uses <a href="https://en.wikipedia.org/wiki/Straw_chamber">straw chambers</a> (which we call <i>wires</i> for simplicity), these are long tubes, which fill detector. They are filled with gas, which is ionized by moving charged particles (mostly, electrons).<br /><br />After ionization, electrons and ions are moving to opposite directions, so we probably can estimate the moment of ionization by drift time (which is of course much greater compared to time of particle flight in detector). Drift time also gives approximate information about the distance between center of wire and track.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-PtaAqxEd00Y/VZXfF2G7YFI/AAAAAAAAAGI/yyjR-eGmINM/s1600/StrawStructure.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="303" src="http://1.bp.blogspot.com/-PtaAqxEd00Y/VZXfF2G7YFI/AAAAAAAAAGI/yyjR-eGmINM/s400/StrawStructure.jpg" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Straw tubes used in many detector systems</td></tr></tbody></table><br /><br />Finally, each wire has one more characteristic, namely, the distance to target:<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-zZWVpjhjjaw/VZXfXret-KI/AAAAAAAAAGU/6R9rEccimQA/s1600/COMETlayer.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto; text-align: center;"><img border="0" height="262" src="http://4.bp.blogspot.com/-zZWVpjhjjaw/VZXfXret-KI/AAAAAAAAAGU/6R9rEccimQA/s320/COMETlayer.jpg" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Signal hits are more frequent on the inner layers by construction of experiment.</td></tr></tbody></table><br /><br /><br /><br />The time is counted from the moment of when trigger worked (it's another subdetector system). The event is 'recorded' starting from that moment.<br /><br />The basic algorithm that was proposed (baseline algorithm) is using the cut on energy deposition. As you can see, there is really significant difference: energy deposited by background hits is higher. The reason is that background particles are moving slower, so they ionize more particles.<br /><br />ROC AUC when we use the only feature - energy, is around 0.95, which seems to be very high. Nevertheless, it's not enough, since we have around 4400 wires, of which around 1000 gets activated (this number is called occupancy) within each measurement (event), while the signal track usually contains around 80 points.<br /><br />So the event is represented using 4400 pairs (energy, time), of which most are zeros.<br /><br />So the noise which passes through such basic filter is still very significant and there is large room for improvements.<br /><div data-select-like-a-boss="1"><br /></div>First, let's combine all the information we have about the single wire (distance from center, time and energy deposition), let's call them wire features:<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-799LH1CKBL8/VZXi8leGp6I/AAAAAAAAAGs/D9h7uB45OEc/s1600/COMETlocalsimplerocs.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="285" src="http://1.bp.blogspot.com/-799LH1CKBL8/VZXi8leGp6I/AAAAAAAAAGs/D9h7uB45OEc/s320/COMETlocalsimplerocs.jpg" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">ROC curves (using physical notation here), we see that usage of wire features made us able to twice decrease the background efficiency.&nbsp;</td></tr></tbody></table><h3>Neighbors features</h3>Let me remind you, how the whole picture of hits in COMET detector looks like (we use here projection on the plane, orthogonal to beam line):<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-gySTATwUGjU/VYfabjmTIZI/AAAAAAAAAEM/keYlmMJBNj0/s1600/COMET2dprojection.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="317" src="http://3.bp.blogspot.com/-gySTATwUGjU/VYfabjmTIZI/AAAAAAAAAEM/keYlmMJBNj0/s320/COMET2dprojection.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><br />Blue dots designate background hits, most of which are tracks of different charged particles, say protons; but some of them are simply noise.<br />Signal hits, which we are looking for, &nbsp;are red points forming an arc of circle. It's approximate radius is known ahead.</td></tr></tbody></table><br />Simple but useful observation one can see in this plot: signal hits nearly always come together.<br />This implies that we can try using features collected from neighbours of point.<br /><br />This drives to dramatic improvement of &nbsp;classification: we almost get rid of random noise tracks, still there are some coupled misidentified tracks. AUC is about 0.995, fpr (background efficiency) decreased by 4-5 times. In principle it suffices to use only information from left and right wires from the same layer.<br /><br />Ok, I believe that was simple. Is there still something we missed and that could be improved?<br />For sure, this is the whole shape of the track. It's time to try using this information.<br /><br /><h3>Hough transform and circle shape</h3><a href="https://en.wikipedia.org/wiki/Hough_transform">Hough transform</a> was initially developed to detect lines and circles. Being quite trivial, it is one of the most effective algorithms in high energy physics.<br /><br />After using GBDT trained on wire features and features of its neighbours, we are getting quite clean picture with very few false positives. All we want is to detect and remove possible isolated 'islands' with misidentified background hits.<br /><br />This is done by very approximate reconstruction of track centers. Since we know approximate radius of track center, we can use the Hough transform with fixed radius. It looks like:<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-ARDD9YjXqBg/VZhVstUtWMI/AAAAAAAAAG8/WFWrhGKaBSQ/s1600/COMEThoughradius.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://1.bp.blogspot.com/-ARDD9YjXqBg/VZhVstUtWMI/AAAAAAAAAG8/WFWrhGKaBSQ/s1600/COMEThoughradius.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Visualization of Hough transform for circles with fixed radius. We are trying to reconstruct the center of track, going through red points. Assuming that we know the radius of fitted track, all possible centers are laying on the circle with center in red point.</td></tr></tbody></table>We discretize the space of possible track centers and for each point we reconstruct how likely it is the center of track. It is done using sparse matrices and some normalization + regularization (because otherwise tracks with few or many points will have very low/high probabilities).<br /><br />Once we computed Hough transform, we leave only those centers, where hough transform is high, applying some nonlinear transformation there and applying inverse hough + some filtering. This way we obtain for each wire the probability that it belongs to some signal track.<br /><div data-select-like-a-boss="1"><br /></div>Finally, we collect all the information we get for each wire:<br /><br /><ul><li>local features (energy deposition, timing, layer_id)</li><li>features collected from neighbors</li><li>result of inverse hough transform</li></ul><div>And train GBDT on these features to obtain final classifier. It's ROC AUC is 0.9993 (100 times less probability of misordering)</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-cLq_DBAe-3c/VZhbn4_TdDI/AAAAAAAAAHM/oLMcqe-SO80/s1600/COMETfinalgbdt.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="356" src="http://4.bp.blogspot.com/-cLq_DBAe-3c/VZhbn4_TdDI/AAAAAAAAAHM/oLMcqe-SO80/s400/COMETfinalgbdt.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Final classifier is red and it is very close to ideal one. The ROC AUC is about 0.9993</td></tr></tbody></table><div><br /></div><div>When we are comparing ROC curves at the threshold of interest (with very high signal sensitivity), things are bit worse, but still very impressing:&nbsp;</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-1j3yHp1eRm8/VZhc4S81kmI/AAAAAAAAAHY/jmb5qN0h8t8/s1600/COMETfinalroccurves.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="305" src="http://2.bp.blogspot.com/-1j3yHp1eRm8/VZhc4S81kmI/AAAAAAAAAHY/jmb5qN0h8t8/s400/COMETfinalroccurves.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">At stable benchmark, the background yield decreased by factor of 34. Original ROC curve is not seen on the plot, since it is much lower.</td></tr></tbody></table><div></div><div><br /></div><br /><h3>Visualization of all steps</h3><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-iqvqvjK5uI8/VZhfOrQbBhI/AAAAAAAAAHk/ohkr0KGskjM/s1600/COMETtracks1.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="396" src="http://1.bp.blogspot.com/-iqvqvjK5uI8/VZhfOrQbBhI/AAAAAAAAAHk/ohkr0KGskjM/s400/COMETtracks1.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Initial picture of hits in CyDET. Red are signal tracks, blue are background ones.</td></tr></tbody></table><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-xjOe4ya6a80/VZhfPeNcQMI/AAAAAAAAAHw/D-IYLUpY9ts/s1600/COMETtracks2.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="396" src="http://4.bp.blogspot.com/-xjOe4ya6a80/VZhfPeNcQMI/AAAAAAAAAHw/D-IYLUpY9ts/s400/COMETtracks2.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">After we apply initial GBDT (which uses wire features + neighbors), we have some bck hits (to the right, for instance). See the 'island' of misidentified background to the right.<br />By greed dots we denote the possible centers of tracks. The bigger the point, the greater value of Hough transform image.<br /><br /></td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-Hpbx7kXsDus/VZhfQef2x-I/AAAAAAAAAH4/t7nAPprXaWw/s1600/COMETtracks3.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="396" src="http://1.bp.blogspot.com/-Hpbx7kXsDus/VZhfQef2x-I/AAAAAAAAAH4/t7nAPprXaWw/s400/COMETtracks3.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Now we apply some non-linear transformations to leave only centers with very high probability. Then applying inverse hough transform and apply second GBDT, which incorporates also information from inverse Hough transform.</td></tr></tbody></table><div><br /></div><h3>Conclusion</h3>I've described how simple machine learning techniques coupled with well-known algorithms can produce a very good result, superior to many complex approaches.<br />These results are to be checked on better simulation data, when it will be ready. Also we have some ideas about possibilities of classification for online triggers, which use same ideas.<br /><h3>Links</h3><br /><ol><li><a href="https://github.com/e-gillies-ix/track-finding-yandex" style="-webkit-user-select: text !important; background-color: white; color: #6a6a6a; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.3000001907349px; line-height: 20.0200004577637px; outline: none !important;">Repository</a><span style="background-color: white; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.3000001907349px; line-height: 20.0200004577637px;">&nbsp;with algorithms and results of tracking.<br />Most of plots are taken from it, thanks to Ewen Gillies.</span></li><li><span style="background-color: white; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.3000001907349px; line-height: 20.0200004577637px;"><a href="http://github.com/yandex/REP">Reproducible experiment platform</a> used in experiments, gradient boosting was used from <a href="https://github.com/scikit-learn/scikit-learn">scikit-learn</a></span></li><li><a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.382.1310&amp;rep=rep1&amp;type=pdf">Review of straw chambers</a>. Straw chambers are used within many different experiments due to their high resolution and cheapness.</li></ol><div><br /></div>